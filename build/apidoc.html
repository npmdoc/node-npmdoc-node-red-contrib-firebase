<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/deldrid1/node-red-contrib-firebase"

    >node-red-contrib-firebase (v1.1.1)</a>
</h1>
<h4>Node-Red module for interacting with Firebase</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red-contrib-firebase">module node-red-contrib-firebase</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red-contrib-firebase.firebase_auth">
            function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_auth
            <span class="apidocSignatureSpan">(RED)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red-contrib-firebase.firebase_config">
            function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_config
            <span class="apidocSignatureSpan">(RED)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red-contrib-firebase.firebase_modify">
            function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_modify
            <span class="apidocSignatureSpan">(RED)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red-contrib-firebase.firebase_off">
            function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_off
            <span class="apidocSignatureSpan">(RED)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red-contrib-firebase.firebase_on">
            function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_on
            <span class="apidocSignatureSpan">(RED)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red-contrib-firebase.firebase_once">
            function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_once
            <span class="apidocSignatureSpan">(RED)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red-contrib-firebase.firebase_ondisconnect">
            function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_ondisconnect
            <span class="apidocSignatureSpan">(RED)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red-contrib-firebase.firebase_auth">module node-red-contrib-firebase.firebase_auth</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red-contrib-firebase.firebase_auth.firebase_auth">
            function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_auth
            <span class="apidocSignatureSpan">(RED)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red-contrib-firebase.firebase_config">module node-red-contrib-firebase.firebase_config</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red-contrib-firebase.firebase_config.firebase_config">
            function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_config
            <span class="apidocSignatureSpan">(RED)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red-contrib-firebase.firebase_modify">module node-red-contrib-firebase.firebase_modify</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red-contrib-firebase.firebase_modify.firebase_modify">
            function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_modify
            <span class="apidocSignatureSpan">(RED)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red-contrib-firebase.firebase_off">module node-red-contrib-firebase.firebase_off</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red-contrib-firebase.firebase_off.firebase_off">
            function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_off
            <span class="apidocSignatureSpan">(RED)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red-contrib-firebase.firebase_on">module node-red-contrib-firebase.firebase_on</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red-contrib-firebase.firebase_on.firebase_on">
            function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_on
            <span class="apidocSignatureSpan">(RED)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red-contrib-firebase.firebase_once">module node-red-contrib-firebase.firebase_once</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red-contrib-firebase.firebase_once.firebase_once">
            function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_once
            <span class="apidocSignatureSpan">(RED)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.node-red-contrib-firebase.firebase_ondisconnect">module node-red-contrib-firebase.firebase_ondisconnect</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.node-red-contrib-firebase.firebase_ondisconnect.firebase_ondisconnect">
            function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_ondisconnect
            <span class="apidocSignatureSpan">(RED)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red-contrib-firebase" id="apidoc.module.node-red-contrib-firebase">module node-red-contrib-firebase</a></h1>


    <h2>
        <a href="#apidoc.element.node-red-contrib-firebase.firebase_auth" id="apidoc.element.node-red-contrib-firebase.firebase_auth">
        function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_auth
        <span class="apidocSignatureSpan">(RED)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">firebase_auth = function (RED) {
    &#x27;use strict&#x27;;

    function FirebaseAuth(n) {
        RED.nodes.createNode(this,n);

        this.config = RED.nodes.getNode(n.firebaseconfig);
        this.name = n.name;
        this.ready = false;

        // Check credentials
        if (!this.config) {
            this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:&#x22;invalid credentials&#x22;})
            this.error(&#x27;You need to setup Firebase credentials!&#x27;);
            return
        }

        this.fbAuthorized = function(authData){
          // this.log(&#x22;authorized&#x22;)
          this.status({fill:&#x22;green&#x22;, shape:&#x22;dot&#x22;, text:&#x22;ready&#x22;})
          this.send({payload: authData})
        }.bind(this)

        this.fbUnauthorized = function(){
          // this.log(&#x22;unauthorized&#x22;)
          this.status({fill:&#x22;red&#x22;, shape:&#x22;dot&#x22;, text:&#x22;unauthorized&#x22;})
          this.send({payload: null})
        }.bind(this)


        //Register Handlers

        this.config.fbConnection.on(&#x22;authorized&#x22;, this.fbAuthorized)
        this.config.fbConnection.on(&#x22;unauthorized&#x22;, this.fbUnauthorized)

        if(this.config.fbConnection.authData)
            this.send({payload: this.config.fbConnection.authData})



          this.on(&#x27;close&#x27;, function() {
            //Cancel modify request to firebase??
          });

    }
    RED.nodes.registerType(&#x22;firebase auth&#x22;, FirebaseAuth);

    RED.httpAdmin.post(&#x22;/firebase/:id/auth&#x22;, RED.auth.needsPermission(&#x22;firebase.write&#x22;), function(req,res) {
            var node = RED.nodes.getNode(req.params.id);
            if (node !== null &#x26;&#x26; typeof node !== &#x22;undefined&#x22; ) {
                node.send({payload: node.config.fbConnection.authData});
                res.sendStatus(200)
            } else {
                res.send(404);
            }
        });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red-contrib-firebase.firebase_config" id="apidoc.element.node-red-contrib-firebase.firebase_config">
        function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_config
        <span class="apidocSignatureSpan">(RED)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">firebase_config = function (RED) {
    &#x27;use strict&#x27;;
    var Firebase = require(&#x27;firebase&#x27;);
    var FirebaseTokenGenerator = require(&#x22;firebase-token-generator&#x22;);
    var events = require(&#x22;events&#x22;);
    var path = require(&#x22;path&#x22;);
    var https = require(&#x22;follow-redirects&#x22;).https;
    var urllib = require(&#x22;url&#x22;);
    // var async = require(&#x22;async&#x22;)

    function generateUID(){
      return &#x27;xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx&#x27;.replace(/[xy]/g, function(c) { //Generates a random RequestID
          var r = Math.random()*16|0, v = c == &#x27;x&#x27; ? r : (r&#x26;0x3|0x8);
          return v.toString(16);
      });
    }

    // Firebase Full Authentication Error Listing - https://www.firebase.com/docs/web/guide/user-auth.html#section-full-error
    // AUTHENTICATION_DISABLED	The requested authentication provider is disabled for this Firebase.
    // EMAIL_TAKEN	The new user account cannot be created because the specified email address is already in use.
    // INVALID_ARGUMENTS	The specified credentials are malformed or incomplete. Please refer to the error message, error details
, and Firebase documentation for the required arguments for authenticating with this provider.
    // INVALID_CONFIGURATION	The requested authentication provider is misconfigured, and the request cannot complete. Please confirm
 that the provider&#x27;s client ID and secret are correct in your Firebase Dashboard and the app is properly set up on the provider&#x27;
s website.
    // INVALID_CREDENTIALS	The specified authentication credentials are invalid. This may occur when credentials are malformed or
 expired.
    // INVALID_EMAIL	The specified email is not a valid email.
    // INVALID_ORIGIN	A security error occurred while processing the authentication request. The web origin for the request is not
 in your list of approved request origins. To approve this origin, visit the Login &#x26; Auth tab in your Firebase dashboard.
    // INVALID_PASSWORD	The specified user account password is incorrect.
    // INVALID_PROVIDER	The requested authentication provider does not exist. Please consult the Firebase authentication documentation
 for a list of supported providers.
    // INVALID_TOKEN	The specified authentication token is invalid. This can occur when the token is malformed, expired, or the
Firebase secret that was used to generate it has been revoked.
    // INVALID_USER	The specified user account does not exist.
    // NETWORK_ERROR	An error occurred while attempting to contact the authentication server.
    // PROVIDER_ERROR	A third-party provider error occurred. Please refer to the error message and error details for more information
.
    // TRANSPORT_UNAVAILABLE	The requested login method is not available in the user&#x27;s browser environment. Popups are not available
 in Chrome for iOS, iOS Preview Panes, or local, file:// URLs. Redirects are not available in PhoneGap / Cordova, or local, file
:// URLs.
    // UNKNOWN_ERROR	An unknown error occurred. Please refer to the error message and error details for more information.
    // USER_CANCELLED	The current authentication request was cancelled by the user.
    // USER_DENIED	The user did not authorize the application. This error can occur when the user has cancelled an OAuth authentication
 request.

    //TODO: Where is the full Firebase Error listing for .set(), etc.?

    //connectionPool is responsible for managing Firebase Connections, Authentication, etc.
    //connectionPool emits the following events:
      //initializing
      //connected
      //disconnected
      //authorized
      //unauthorized
      //error //TODO: need to wrap everything in a try/catch to make sure we don&#x27;t ever crash node-red
      //closed
    var connectionPool = function(){  //TODO: This could probably be refactored to be a bit simpler now...
      var connections = {}

      return {
        get: function(firebaseurl, configNodeID){
          if(!connections[configNodeID]){ //Lazily create a new Firebase Reference if it does not exist

            connections[configNodeID] = function(){

              //Private
              var _emitter = new events. ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red-contrib-firebase.firebase_modify" id="apidoc.element.node-red-contrib-firebase.firebase_modify">
        function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_modify
        <span class="apidocSignatureSpan">(RED)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">firebase_modify = function (RED) {
  &#x27;use strict&#x27;;

  String.prototype.capitalize = function() {
      return this.charAt(0).toUpperCase() + this.slice(1);
  }

  function FirebaseModify(n) {
      RED.nodes.createNode(this,n);

      this.config = RED.nodes.getNode(n.firebaseconfig);
      this.childpath = n.childpath;
      this.value = n.value;
      this.method = n.method;
      this.priority = n.priority;
      this.fbRequests = [];

      this.ready = false;

      this.validMethods = {
        &#x22;set&#x22;: true,
        &#x22;update&#x22;: true,
        &#x22;push&#x22;: true,
        &#x22;remove&#x22;: true,
    		&#x22;setPriority&#x22;: true,
    		&#x22;setWithPriority&#x22;: true
      }

      // Check credentials
      if (!this.config) {
          this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:&#x22;invalid credentials&#x22;})
          this.error(&#x27;You need to setup Firebase credentials!&#x27;);
          return
      }

      this.fbOnComplete = function(error) {
          //this.log(&#x22;fb oncomplete.  error = &#x22; + error)
          var msg = this.fbRequests.shift() //Firebase will call these in order for us
          //TODO: Once Node-Red supports it, we should flash the Node when we receive this data.
          if(error){
            this.log(&#x22;firebase synchronization failed&#x22;)
            this.error(&#x22;firebase synchronization failed - &#x22; + error, msg)
          } else {
          	this.send(msg)
          }
      }.bind(this);


      //this.config.fbConnection EventEmitter Handlers
      this.fbInitializing = function(){  //This isn&#x27;t being called because its emitted too early...
        this.status({fill:&#x22;grey&#x22;, shape:&#x22;ring&#x22;, text:&#x22;initializing...&#x22;})
        this.ready = false;
      }.bind(this)

      this.fbConnected = function(){
        this.status({fill:&#x22;green&#x22;, shape:&#x22;ring&#x22;, text:&#x22;connected&#x22;})
        this.ready = false;
      }.bind(this)

      this.fbDisconnected = function(){
        this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:&#x22;disconnected&#x22;})
        this.ready = false;
      }.bind(this)

      this.fbAuthorized = function(authData){
        this.status({fill:&#x22;green&#x22;, shape:&#x22;dot&#x22;, text:&#x22;ready&#x22;})
        this.ready = true;
      }.bind(this)

      this.fbUnauthorized = function(){
        this.status({fill:&#x22;red&#x22;, shape:&#x22;dot&#x22;, text:&#x22;unauthorized&#x22;})
        this.ready = false;
      }.bind(this)

      this.fbError = function(error){
        this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:error})
      }.bind(this)

      this.fbClosed = function(error){
        this.status({fill: &#x22;gray&#x22;, shape: &#x22;dot&#x22;, text:&#x22;connection closed&#x22;})
        this.ready = false;
      }.bind(this)


      //Register Handlers
      this.config.fbConnection.on(&#x22;initializing&#x22;, this.fbInitializing)
      this.config.fbConnection.on(&#x22;connected&#x22;, this.fbConnected)
      this.config.fbConnection.on(&#x22;disconnected&#x22;, this.fbDisconnected)
      this.config.fbConnection.on(&#x22;authorized&#x22;, this.fbAuthorized)
      this.config.fbConnection.on(&#x22;unauthorized&#x22;, this.fbUnauthorized)
      this.config.fbConnection.on(&#x22;error&#x22;, this.fbError)
      this.config.fbConnection.on(&#x22;closed&#x22;, this.fbClosed)

      //set initial state (depending on the deployment strategy, for newly deployed nodes, some of the events may not be refired
...)
      switch(this.config.fbConnection.lastEvent) {
        case &#x22;initializing&#x22;:
        case &#x22;connected&#x22;:
        case &#x22;disconnected&#x22;:
        case &#x22;authorized&#x22;:
        case &#x22;unauthorized&#x22;:
        case &#x22;error&#x22;:
        case &#x22;closed&#x22;:
          this[&#x22;fb&#x22; + this.config.fbConnection.lastEvent.capitalize()](this.config.fbConnection.lastEventData)  //Javascript is
really friendly about sending arguments to functions...
          break;
        // case &#x22;undefined&#x22;:
        // case &#x22;null&#x22;:
        //   break;  //Config node not yet setup
        default:
          this.error(&#x22;Bad lastEvent Data from Config Node - &#x22; + this.config.fbConnection.lastEvent)
      }


      this.on(&#x27;input&#x27;, function(msg) {
        if(this.ready){

          //TODO: this seems to be mostly working, but we really ought to do some more due diligence here...
          //Try to convert to JSON object...
          //Parse out msg.method ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red-contrib-firebase.firebase_off" id="apidoc.element.node-red-contrib-firebase.firebase_off">
        function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_off
        <span class="apidocSignatureSpan">(RED)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">firebase_off = function (RED) {
    &#x27;use strict&#x27;;

    function FirebaseOff(n) {
        RED.nodes.createNode(this,n);

        this.config = RED.nodes.getNode(n.firebaseconfig);
        this.childpath = n.childpath;
        this.eventType = n.eventType;

        // Check credentials
        if (!this.config) {
            this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:&#x22;invalid credentials&#x22;})
            this.error(&#x27;You need to setup Firebase credentials!&#x27;);
            return
        }

        this.validEventTypes = {
          &#x22;value&#x22;: true,
          &#x22;child_added&#x22;: true,
          &#x22;child_changed&#x22;: true,
          &#x22;chiled_removed&#x22;: true,
          &#x22;child_moved&#x22;: true,
          &#x22;shallow_query&#x22;: true
        }

        this.setStatus = function(error){
          //set = state (depending on the deployment strategy, for newly deployed nodes, some of the events may not be refired...)
          switch(this.config.fbConnection.lastEvent) {
            case &#x22;initializing&#x22;:
              this.status({fill:&#x22;grey&#x22;, shape:&#x22;ring&#x22;, text:&#x22;initializing...&#x22;})
              break;
            case &#x22;connected&#x22;:
              this.status({fill:&#x22;green&#x22;, shape:&#x22;ring&#x22;, text:&#x22;connected&#x22;})
              break;
            case &#x22;disconnected&#x22;:
              this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:&#x22;disconnected&#x22;})
              break;
            case &#x22;authorized&#x22;:
              this.status({fill:&#x22;green&#x22;, shape:&#x22;dot&#x22;, text:&#x22;ready&#x22;})
              break;
            case &#x22;unauthorized&#x22;:
              this.status({fill:&#x22;red&#x22;, shape:&#x22;dot&#x22;, text:&#x22;unauthorized&#x22;})
              break;
            case &#x22;error&#x22;:
              this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:error || &#x22;error&#x22;}) //TODO: should we store the last error?
              break;
            case &#x22;closed&#x22;:
              this.status({fill: &#x22;gray&#x22;, shape: &#x22;dot&#x22;, text:&#x22;connection closed&#x22;})
              break;
            // case &#x22;undefined&#x22;:
            // case &#x22;null&#x22;:
            //   break;  //Config node not yet setup
            default:
              this.error(&#x22;Bad lastEvent Data from Config Node - &#x22; + this.config.fbConnection.lastEvent)
          }

        }.bind(this)

        //this.config.fbConnection EventEmitter Handlers
        this.fbInitializing = function(){  //This isn&#x27;t being called because its emitted too early...
          // this.log(&#x22;initializing&#x22;)
          this.setStatus();
        }.bind(this)

        this.fbConnected = function(){
          // this.log(&#x22;connected&#x22;)
          this.setStatus();
        }.bind(this)

        this.fbDisconnected = function(){
          // this.log(&#x22;disconnected&#x22;)
          this.setStatus();
        }.bind(this)

        this.fbAuthorized = function(authData){
          // this.log(&#x22;authorized&#x22;)
          this.setStatus();
        }.bind(this)

        this.fbUnauthorized = function(){
          // this.log(&#x22;unauthorized&#x22;)
          this.setStatus();
        }.bind(this)

        this.fbError = function(error){
          // this.log(&#x22;error - &#x22; + error)
          this.setStatus(error);
          this.error(error, {})
        }.bind(this)

        this.fbClosed = function(){
          // this.log(&#x22;closed&#x22;)
          this.setStatus();
        }.bind(this)


        //Register Handlers
        this.config.fbConnection.on(&#x22;initializing&#x22;, this.fbInitializing)
        this.config.fbConnection.on(&#x22;connected&#x22;, this.fbConnected)
        this.config.fbConnection.on(&#x22;disconnected&#x22;, this.fbDisconnected)
        this.config.fbConnection.on(&#x22;authorized&#x22;, this.fbAuthorized)
        this.config.fbConnection.on(&#x22;unauthorized&#x22;, this.fbUnauthorized)
        this.config.fbConnection.on(&#x22;error&#x22;, this.fbError)
        this.config.fbConnection.on(&#x22;closed&#x22;, this.fbClosed)

        // this.log(&#x22;setting initial state to [fb&#x22; + this.config.fbConnection.lastEvent.capitalize()+ &#x22;](&#x22;+this.config.fbConnection
.lastEventData+&#x22;)&#x22; )

        //set initial state (depending on the deployment strategy, for newly deployed nodes, some of the events may not be refired
...)
        this[&#x22;fb&#x22; + this.config.fbConnection.lastEvent.capitalize()](this.config.fbConnection.lastEventData)  // ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red-contrib-firebase.firebase_on" id="apidoc.element.node-red-contrib-firebase.firebase_on">
        function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_on
        <span class="apidocSignatureSpan">(RED)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">firebase_on = function (RED) {
    &#x27;use strict&#x27;;

    var getPushIdTimestamp = (function getPushIdTimestamp() {
      var PUSH_CHARS = &#x27;-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz&#x27;;

      return function getTimestampFromId(id) {
        try {
          var time = 0;
          var data = id.substr(0, 8);

          for (var i = 0; i &#x3c; 8; i++) {
            time = time * 64 + PUSH_CHARS.indexOf(data[i]);
          }

          return time;
        } catch(ex){}
      }
    })();

    function FirebaseOn(n) {
        RED.nodes.createNode(this,n);

        this.config = RED.nodes.getNode(n.firebaseconfig);
        this.childpath = n.childpath;
        this.atStart = n.atStart;
        this.eventType = n.eventType;
		    this.queries = n.queries

        this.ready = false;
        this.ignoreFirst = this.atStart;
        this.authorized = false;
        this.msg = null;

        // Check credentials
        if (!this.config) {
            this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:&#x22;invalid credentials&#x22;})
            this.error(&#x27;You need to setup Firebase credentials!&#x27;);
            return
        }

        this.validEventTypes = {
          &#x22;value&#x22;: true,
          &#x22;child_added&#x22;: true,
          &#x22;child_changed&#x22;: true,
          &#x22;chiled_removed&#x22;: true,
          &#x22;child_moved&#x22;: true,
          &#x22;shallow_query&#x22;: true
        }

        this.onFBValue = function(snapshot, prevChildName) {
            //console.log(&#x22;In onFBValue + &#x22; + JSON.stringify(snapshot.val()))

            if(this.ignoreFirst == false){
              this.ignoreFirst = true
              return;
            }

            this.status({fill:&#x22;blue&#x22;,shape:&#x22;dot&#x22;,text:&#x22;received data&#x22;});

            // if(!snapshot.exists()){
            //   //The code below will simply send a payload of nul if there is no data
            // }

            var msg = {};
            msg.href = snapshot.ref().toString();
            msg.key = snapshot.key();
            msg.payload = snapshot.val();
            if(snapshot.getPriority())
              msg.priority = snapshot.getPriority();
            if(prevChildName)
              msg.previousChildName = prevChildName;
            if(this.eventType.search(&#x22;child&#x22;) != -1 &#x26;&#x26; getPushIdTimestamp(msg.key))  //We probably have a pushID that we can decode
              msg.pushIDTimestamp = getPushIdTimestamp(msg.key)


            this.send(msg);
            setTimeout(this.setStatus, 500)  //Reset back to the Firebase status after 0.5 seconds
        }.bind(this);

        this.onFBError = function(error){
          this.error(error, {})
          this.status({fill:&#x22;red&#x22;,shape:&#x22;ring&#x22;,text:error.code || &#x22;error&#x22;});
          setTimeout(this.setStatus, 5000)  //Reset back to the Firebase status after 5 seconds
        }.bind(this);

        this.registerListeners = function(msg){
          //this.log(&#x22;Registering Listener for &#x22; + this.config.firebaseurl + (this.childpath || &#x22;&#x22;))

          if(this.ready == true)
            return  //Listeners are already created

          this.ready = true;
          this.ignoreFirst = this.atStart;  //Reset if we are re-registering listeners

          //Create the firebase reference to the path
          var ref
          if(this.childpath){
            ref = this.config.fbConnection.fbRef.child(this.childpath  == &#x22;msg.childpath&#x22; ? this.msg.childpath : this.childpath)  //
Decide if we are using our input msg object or the string we were configured with
          } else {
            ref = this.config.fbConnection.fbRef
          }

          //apply the queries
          for (var i=0; i&#x3c;this.queries.length; i+=1) {
              var query = this.queries[i];
              var val

              switch(query.name){
                case &#x22;orderByKey&#x22;:
                case &#x22;orderByValue&#x22;:
                case &#x22;orderByPriority&#x22;:
                  ref = ref[query.name]()  //No args //TODO: BUG: Update HTML to hide box for these 3...
                  break;

                case &#x22;orderByChild&#x22;:
                case &#x22;startAt&#x22;:
                case &#x22;endAt&#x22;:
                case &#x22;equalTo&#x22;: ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red-contrib-firebase.firebase_once" id="apidoc.element.node-red-contrib-firebase.firebase_once">
        function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_once
        <span class="apidocSignatureSpan">(RED)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">firebase_once = function (RED) {
    &#x27;use strict&#x27;;
    var https = require(&#x22;follow-redirects&#x22;).https;
    var urllib = require(&#x22;url&#x22;);

    var getPushIdTimestamp = (function getPushIdTimestamp() {
      var PUSH_CHARS = &#x27;-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz&#x27;;

      return function getTimestampFromId(id) {
        try {
          var time = 0;
          var data = id.substr(0, 8);

          for (var i = 0; i &#x3c; 8; i++) {
            time = time * 64 + PUSH_CHARS.indexOf(data[i]);
          }

          return time;
        } catch(ex){}
      }
    })();

    function FirebaseOnce(n) {
        RED.nodes.createNode(this,n);

        this.config = RED.nodes.getNode(n.firebaseconfig);
        this.childpath = n.childpath;
        this.eventType = n.eventType;
        this.queries = n.queries;
        this.repeatifnull = n.repeatifnull;

        this.activeRequests = [];
        this.ready = false;

        // Check credentials
        if (!this.config) {
            this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:&#x22;invalid credentials&#x22;})
            this.error(&#x27;You need to setup Firebase credentials!&#x27;);
            return
        }

        // for (var i=0; i&#x3c;this.queries.length; i+=1) {
        //     var query = this.queries[i];
        //     if (!isNaN(Number(query.value))) {
        //       query.value = Number(query.value);
        //       query.value2 = Number(query.value2);
        //     }
        // }

        this.validEventTypes = {
          &#x22;value&#x22;: true,
          &#x22;child_added&#x22;: true,
          &#x22;child_changed&#x22;: true,
          &#x22;chiled_removed&#x22;: true,
          &#x22;child_moved&#x22;: true,
          &#x22;shallow_query&#x22;: true
        }

        this.onFBData = function(snapshot, prevChildName) {
            //console.log(&#x22;In onFBData + &#x22; + JSON.stringify(snapshot.val()))
            //TODO: Once Node-Red supports it, we should flash the Node when we receive this data.

            // if(!snapshot.exists()){
            //   //The code below will simply send a payload of nul if there is no data
            // }

            //Tstart with original message object so we retain all of those properties...
            var msg = this.activeRequests.shift();

            msg.href = snapshot.ref().toString();
            msg.key = snapshot.key();
            msg.payload = snapshot.val();
            if(snapshot.getPriority())
              msg.priority = snapshot.getPriority();
            if(prevChildName)
              msg.previousChildName = prevChildName;
            if(this.eventType.search(&#x22;child&#x22;) != -1 || msg.key.length == 20 &#x26;&#x26; getPushIdTimestamp(msg.key))  //We probably have
a pushID that we can decode
              msg.pushIDTimestamp = getPushIdTimestamp(msg.key)

            if(this.repeatifnull &#x26;&#x26; msg.payload == null &#x26;&#x26; msg.attemptNumber++ &#x3c; 100 ){ // Repeat sending the request.  //TODO:
we could use a configurable timer in seconds or a configurable number of attempts
              this.registerListeners(msg)
            } else {
              this.send(msg);
            }

            this.setStatus();
        }.bind(this);

        this.onFBError = function(error){
          this.error(error, {})
          this.status({fill:&#x22;red&#x22;,shape:&#x22;ring&#x22;,text:error.code || &#x22;error&#x22;});
          setTimeout(this.setStatus, 5000)  //Reset back to the Firebase status after 5 seconds
        }.bind(this);

        this.registerListeners = function(msg){

          var eventType = this.eventType
          if(eventType == &#x22;msg.eventType&#x22;){
            if(&#x22;eventType&#x22; in msg){
              eventType = msg.eventType
            } else {
              this.error(&#x22;Expected \&#x22;eventType\&#x22; property in msg object&#x22;, msg)
              return;
            }
          }

          if(!(eventType in this.validEventTypes)){
            this.error(&#x22;Invalid msg.eventType property \&#x22;&#x22; + eventType + &#x22;\&#x22;.  Expected one of the following: [\&#x22;&#x22; + Object.keys
(this.validEventTypes).join(&#x22;\&#x22;, \&#x22;&#x22;) + &#x22;\&#x22;].&#x22;, msg)
            return;
          }

          //Parse out msg.childpath
          var childpath = this.childpath
          if(childpath == &#x22; ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.node-red-contrib-firebase.firebase_ondisconnect" id="apidoc.element.node-red-contrib-firebase.firebase_ondisconnect">
        function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_ondisconnect
        <span class="apidocSignatureSpan">(RED)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">firebase_ondisconnect = function (RED) {
    &#x27;use strict&#x27;;
    var path= require(&#x27;path&#x27;);

    String.prototype.capitalize = function() {
        return this.charAt(0).toUpperCase() + this.slice(1);
    }

    function FirebaseOnDisconnect(n) {
        RED.nodes.createNode(this,n);

        this.config = RED.nodes.getNode(n.firebaseconfig);
        this.name = n.name;
        this.childpath = n.childpath;
        this.method = n.method;
        this.value = n.value;
        this.priority = n.priority;
        this.fbRequests = [];

        this.ready = false;

        this.validMethods = {
          &#x22;set&#x22;: true,
          &#x22;update&#x22;: true,
          &#x22;remove&#x22;: true,
          &#x22;setWithPriority&#x22;: true,
          &#x22;cancel&#x22;: true
        }

        // Check credentials
        if (!this.config) {
            this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:&#x22;invalid credentials&#x22;})
            this.error(&#x27;You need to setup Firebase credentials!&#x27;);
            return
        }

        this.fbOnComplete = function(error) {
            //this.log(&#x22;fb oncomplete.  error = &#x22; + error)
            var msg = this.fbRequests.shift() //Firebase will call these in order for us
            //TODO: Once Node-Red supports it, we should flash the Node when we receive this data.
            if(error){
              //this.log(&#x22;firebase synchronization failed&#x22;)
              this.error(&#x22;firebase synchronization failed - &#x22; + error, msg)
            }
        }.bind(this);


        //this.config.fbConnection EventEmitter Handlers
        this.fbInitializing = function(){  //This isn&#x27;t being called because its emitted too early...
          // this.log(&#x22;initializing&#x22;)
          this.status({fill:&#x22;grey&#x22;, shape:&#x22;ring&#x22;, text:&#x22;initializing...&#x22;})
          this.ready = false;
        }.bind(this)

        this.fbConnected = function(){
          // this.log(&#x22;connected&#x22;)
          this.status({fill:&#x22;green&#x22;, shape:&#x22;ring&#x22;, text:&#x22;connected&#x22;})
          // this.ready = false;
        }.bind(this)

        this.fbDisconnected = function(){
          // this.log(&#x22;disconnected&#x22;)
          this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:&#x22;disconnected&#x22;})
          this.ready = false;
        }.bind(this)

        this.fbAuthorized = function(authData){
          // this.log(&#x22;authorized&#x22;)
          this.status({fill:&#x22;green&#x22;, shape:&#x22;dot&#x22;, text:&#x22;ready&#x22;})
          this.ready = true;
          if (this.value != &#x22;msg.payload&#x22; &#x26;&#x26; this.method != &#x22;msg.method&#x22; &#x26;&#x26; this.childpath != &#x22;msg.childpath&#x22;){
            //this.warn(&#x22;FB Authorized -- explicitly emitting event INPUT&#x22;);
            this.emit(&#x27;input&#x27;, {});
          }
        }.bind(this)

        this.fbUnauthorized = function(){
          // this.log(&#x22;unauthorized&#x22;)
          this.status({fill:&#x22;red&#x22;, shape:&#x22;dot&#x22;, text:&#x22;unauthorized&#x22;})
          this.ready = false;
        }.bind(this)

        this.fbError = function(error){
          // this.log(&#x22;error&#x22;)
          this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:error})
          this.error(error, {})
        }.bind(this)

        this.fbClosed = function(error){
          // this.log(&#x22;closed&#x22;)
          this.status({fill: &#x22;gray&#x22;, shape: &#x22;dot&#x22;, text:&#x22;connection closed&#x22;})
          this.ready = false;
        }.bind(this)

        //Register Handlers
        this.config.fbConnection.on(&#x22;initializing&#x22;, this.fbInitializing)
        this.config.fbConnection.on(&#x22;connected&#x22;, this.fbConnected)
        this.config.fbConnection.on(&#x22;disconnected&#x22;, this.fbDisconnected)
        this.config.fbConnection.on(&#x22;authorized&#x22;, this.fbAuthorized)
        this.config.fbConnection.on(&#x22;unauthorized&#x22;, this.fbUnauthorized)
        this.config.fbConnection.on(&#x22;error&#x22;, this.fbError)
        this.config.fbConnection.on(&#x22;closed&#x22;, this.fbClosed)

        //set initial state (depending on the deployment strategy, for newly deployed nodes, some of the events may not be refired
...)
        switch(this.config.fbConnection.lastEvent) {
          case &#x22;initializing&#x22;:
          case &#x22;connected&#x22;:
          case &#x22;disconnected&#x22;:
          case &#x22;authorized&#x22;:
          case &#x22;unauthorized&#x22;:
          case &#x22;error&#x22;:
          case &#x22;closed&#x22;: ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red-contrib-firebase.firebase_auth" id="apidoc.module.node-red-contrib-firebase.firebase_auth">module node-red-contrib-firebase.firebase_auth</a></h1>


    <h2>
        <a href="#apidoc.element.node-red-contrib-firebase.firebase_auth.firebase_auth" id="apidoc.element.node-red-contrib-firebase.firebase_auth.firebase_auth">
        function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_auth
        <span class="apidocSignatureSpan">(RED)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">firebase_auth = function (RED) {
    &#x27;use strict&#x27;;

    function FirebaseAuth(n) {
        RED.nodes.createNode(this,n);

        this.config = RED.nodes.getNode(n.firebaseconfig);
        this.name = n.name;
        this.ready = false;

        // Check credentials
        if (!this.config) {
            this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:&#x22;invalid credentials&#x22;})
            this.error(&#x27;You need to setup Firebase credentials!&#x27;);
            return
        }

        this.fbAuthorized = function(authData){
          // this.log(&#x22;authorized&#x22;)
          this.status({fill:&#x22;green&#x22;, shape:&#x22;dot&#x22;, text:&#x22;ready&#x22;})
          this.send({payload: authData})
        }.bind(this)

        this.fbUnauthorized = function(){
          // this.log(&#x22;unauthorized&#x22;)
          this.status({fill:&#x22;red&#x22;, shape:&#x22;dot&#x22;, text:&#x22;unauthorized&#x22;})
          this.send({payload: null})
        }.bind(this)


        //Register Handlers

        this.config.fbConnection.on(&#x22;authorized&#x22;, this.fbAuthorized)
        this.config.fbConnection.on(&#x22;unauthorized&#x22;, this.fbUnauthorized)

        if(this.config.fbConnection.authData)
            this.send({payload: this.config.fbConnection.authData})



          this.on(&#x27;close&#x27;, function() {
            //Cancel modify request to firebase??
          });

    }
    RED.nodes.registerType(&#x22;firebase auth&#x22;, FirebaseAuth);

    RED.httpAdmin.post(&#x22;/firebase/:id/auth&#x22;, RED.auth.needsPermission(&#x22;firebase.write&#x22;), function(req,res) {
            var node = RED.nodes.getNode(req.params.id);
            if (node !== null &#x26;&#x26; typeof node !== &#x22;undefined&#x22; ) {
                node.send({payload: node.config.fbConnection.authData});
                res.sendStatus(200)
            } else {
                res.send(404);
            }
        });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red-contrib-firebase.firebase_config" id="apidoc.module.node-red-contrib-firebase.firebase_config">module node-red-contrib-firebase.firebase_config</a></h1>


    <h2>
        <a href="#apidoc.element.node-red-contrib-firebase.firebase_config.firebase_config" id="apidoc.element.node-red-contrib-firebase.firebase_config.firebase_config">
        function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_config
        <span class="apidocSignatureSpan">(RED)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">firebase_config = function (RED) {
    &#x27;use strict&#x27;;
    var Firebase = require(&#x27;firebase&#x27;);
    var FirebaseTokenGenerator = require(&#x22;firebase-token-generator&#x22;);
    var events = require(&#x22;events&#x22;);
    var path = require(&#x22;path&#x22;);
    var https = require(&#x22;follow-redirects&#x22;).https;
    var urllib = require(&#x22;url&#x22;);
    // var async = require(&#x22;async&#x22;)

    function generateUID(){
      return &#x27;xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx&#x27;.replace(/[xy]/g, function(c) { //Generates a random RequestID
          var r = Math.random()*16|0, v = c == &#x27;x&#x27; ? r : (r&#x26;0x3|0x8);
          return v.toString(16);
      });
    }

    // Firebase Full Authentication Error Listing - https://www.firebase.com/docs/web/guide/user-auth.html#section-full-error
    // AUTHENTICATION_DISABLED	The requested authentication provider is disabled for this Firebase.
    // EMAIL_TAKEN	The new user account cannot be created because the specified email address is already in use.
    // INVALID_ARGUMENTS	The specified credentials are malformed or incomplete. Please refer to the error message, error details
, and Firebase documentation for the required arguments for authenticating with this provider.
    // INVALID_CONFIGURATION	The requested authentication provider is misconfigured, and the request cannot complete. Please confirm
 that the provider&#x27;s client ID and secret are correct in your Firebase Dashboard and the app is properly set up on the provider&#x27;
s website.
    // INVALID_CREDENTIALS	The specified authentication credentials are invalid. This may occur when credentials are malformed or
 expired.
    // INVALID_EMAIL	The specified email is not a valid email.
    // INVALID_ORIGIN	A security error occurred while processing the authentication request. The web origin for the request is not
 in your list of approved request origins. To approve this origin, visit the Login &#x26; Auth tab in your Firebase dashboard.
    // INVALID_PASSWORD	The specified user account password is incorrect.
    // INVALID_PROVIDER	The requested authentication provider does not exist. Please consult the Firebase authentication documentation
 for a list of supported providers.
    // INVALID_TOKEN	The specified authentication token is invalid. This can occur when the token is malformed, expired, or the
Firebase secret that was used to generate it has been revoked.
    // INVALID_USER	The specified user account does not exist.
    // NETWORK_ERROR	An error occurred while attempting to contact the authentication server.
    // PROVIDER_ERROR	A third-party provider error occurred. Please refer to the error message and error details for more information
.
    // TRANSPORT_UNAVAILABLE	The requested login method is not available in the user&#x27;s browser environment. Popups are not available
 in Chrome for iOS, iOS Preview Panes, or local, file:// URLs. Redirects are not available in PhoneGap / Cordova, or local, file
:// URLs.
    // UNKNOWN_ERROR	An unknown error occurred. Please refer to the error message and error details for more information.
    // USER_CANCELLED	The current authentication request was cancelled by the user.
    // USER_DENIED	The user did not authorize the application. This error can occur when the user has cancelled an OAuth authentication
 request.

    //TODO: Where is the full Firebase Error listing for .set(), etc.?

    //connectionPool is responsible for managing Firebase Connections, Authentication, etc.
    //connectionPool emits the following events:
      //initializing
      //connected
      //disconnected
      //authorized
      //unauthorized
      //error //TODO: need to wrap everything in a try/catch to make sure we don&#x27;t ever crash node-red
      //closed
    var connectionPool = function(){  //TODO: This could probably be refactored to be a bit simpler now...
      var connections = {}

      return {
        get: function(firebaseurl, configNodeID){
          if(!connections[configNodeID]){ //Lazily create a new Firebase Reference if it does not exist

            connections[configNodeID] = function(){

              //Private
              var _emitter = new events. ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red-contrib-firebase.firebase_modify" id="apidoc.module.node-red-contrib-firebase.firebase_modify">module node-red-contrib-firebase.firebase_modify</a></h1>


    <h2>
        <a href="#apidoc.element.node-red-contrib-firebase.firebase_modify.firebase_modify" id="apidoc.element.node-red-contrib-firebase.firebase_modify.firebase_modify">
        function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_modify
        <span class="apidocSignatureSpan">(RED)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">firebase_modify = function (RED) {
  &#x27;use strict&#x27;;

  String.prototype.capitalize = function() {
      return this.charAt(0).toUpperCase() + this.slice(1);
  }

  function FirebaseModify(n) {
      RED.nodes.createNode(this,n);

      this.config = RED.nodes.getNode(n.firebaseconfig);
      this.childpath = n.childpath;
      this.value = n.value;
      this.method = n.method;
      this.priority = n.priority;
      this.fbRequests = [];

      this.ready = false;

      this.validMethods = {
        &#x22;set&#x22;: true,
        &#x22;update&#x22;: true,
        &#x22;push&#x22;: true,
        &#x22;remove&#x22;: true,
    		&#x22;setPriority&#x22;: true,
    		&#x22;setWithPriority&#x22;: true
      }

      // Check credentials
      if (!this.config) {
          this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:&#x22;invalid credentials&#x22;})
          this.error(&#x27;You need to setup Firebase credentials!&#x27;);
          return
      }

      this.fbOnComplete = function(error) {
          //this.log(&#x22;fb oncomplete.  error = &#x22; + error)
          var msg = this.fbRequests.shift() //Firebase will call these in order for us
          //TODO: Once Node-Red supports it, we should flash the Node when we receive this data.
          if(error){
            this.log(&#x22;firebase synchronization failed&#x22;)
            this.error(&#x22;firebase synchronization failed - &#x22; + error, msg)
          } else {
          	this.send(msg)
          }
      }.bind(this);


      //this.config.fbConnection EventEmitter Handlers
      this.fbInitializing = function(){  //This isn&#x27;t being called because its emitted too early...
        this.status({fill:&#x22;grey&#x22;, shape:&#x22;ring&#x22;, text:&#x22;initializing...&#x22;})
        this.ready = false;
      }.bind(this)

      this.fbConnected = function(){
        this.status({fill:&#x22;green&#x22;, shape:&#x22;ring&#x22;, text:&#x22;connected&#x22;})
        this.ready = false;
      }.bind(this)

      this.fbDisconnected = function(){
        this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:&#x22;disconnected&#x22;})
        this.ready = false;
      }.bind(this)

      this.fbAuthorized = function(authData){
        this.status({fill:&#x22;green&#x22;, shape:&#x22;dot&#x22;, text:&#x22;ready&#x22;})
        this.ready = true;
      }.bind(this)

      this.fbUnauthorized = function(){
        this.status({fill:&#x22;red&#x22;, shape:&#x22;dot&#x22;, text:&#x22;unauthorized&#x22;})
        this.ready = false;
      }.bind(this)

      this.fbError = function(error){
        this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:error})
      }.bind(this)

      this.fbClosed = function(error){
        this.status({fill: &#x22;gray&#x22;, shape: &#x22;dot&#x22;, text:&#x22;connection closed&#x22;})
        this.ready = false;
      }.bind(this)


      //Register Handlers
      this.config.fbConnection.on(&#x22;initializing&#x22;, this.fbInitializing)
      this.config.fbConnection.on(&#x22;connected&#x22;, this.fbConnected)
      this.config.fbConnection.on(&#x22;disconnected&#x22;, this.fbDisconnected)
      this.config.fbConnection.on(&#x22;authorized&#x22;, this.fbAuthorized)
      this.config.fbConnection.on(&#x22;unauthorized&#x22;, this.fbUnauthorized)
      this.config.fbConnection.on(&#x22;error&#x22;, this.fbError)
      this.config.fbConnection.on(&#x22;closed&#x22;, this.fbClosed)

      //set initial state (depending on the deployment strategy, for newly deployed nodes, some of the events may not be refired
...)
      switch(this.config.fbConnection.lastEvent) {
        case &#x22;initializing&#x22;:
        case &#x22;connected&#x22;:
        case &#x22;disconnected&#x22;:
        case &#x22;authorized&#x22;:
        case &#x22;unauthorized&#x22;:
        case &#x22;error&#x22;:
        case &#x22;closed&#x22;:
          this[&#x22;fb&#x22; + this.config.fbConnection.lastEvent.capitalize()](this.config.fbConnection.lastEventData)  //Javascript is
really friendly about sending arguments to functions...
          break;
        // case &#x22;undefined&#x22;:
        // case &#x22;null&#x22;:
        //   break;  //Config node not yet setup
        default:
          this.error(&#x22;Bad lastEvent Data from Config Node - &#x22; + this.config.fbConnection.lastEvent)
      }


      this.on(&#x27;input&#x27;, function(msg) {
        if(this.ready){

          //TODO: this seems to be mostly working, but we really ought to do some more due diligence here...
          //Try to convert to JSON object...
          //Parse out msg.method ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red-contrib-firebase.firebase_off" id="apidoc.module.node-red-contrib-firebase.firebase_off">module node-red-contrib-firebase.firebase_off</a></h1>


    <h2>
        <a href="#apidoc.element.node-red-contrib-firebase.firebase_off.firebase_off" id="apidoc.element.node-red-contrib-firebase.firebase_off.firebase_off">
        function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_off
        <span class="apidocSignatureSpan">(RED)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">firebase_off = function (RED) {
    &#x27;use strict&#x27;;

    function FirebaseOff(n) {
        RED.nodes.createNode(this,n);

        this.config = RED.nodes.getNode(n.firebaseconfig);
        this.childpath = n.childpath;
        this.eventType = n.eventType;

        // Check credentials
        if (!this.config) {
            this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:&#x22;invalid credentials&#x22;})
            this.error(&#x27;You need to setup Firebase credentials!&#x27;);
            return
        }

        this.validEventTypes = {
          &#x22;value&#x22;: true,
          &#x22;child_added&#x22;: true,
          &#x22;child_changed&#x22;: true,
          &#x22;chiled_removed&#x22;: true,
          &#x22;child_moved&#x22;: true,
          &#x22;shallow_query&#x22;: true
        }

        this.setStatus = function(error){
          //set = state (depending on the deployment strategy, for newly deployed nodes, some of the events may not be refired...)
          switch(this.config.fbConnection.lastEvent) {
            case &#x22;initializing&#x22;:
              this.status({fill:&#x22;grey&#x22;, shape:&#x22;ring&#x22;, text:&#x22;initializing...&#x22;})
              break;
            case &#x22;connected&#x22;:
              this.status({fill:&#x22;green&#x22;, shape:&#x22;ring&#x22;, text:&#x22;connected&#x22;})
              break;
            case &#x22;disconnected&#x22;:
              this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:&#x22;disconnected&#x22;})
              break;
            case &#x22;authorized&#x22;:
              this.status({fill:&#x22;green&#x22;, shape:&#x22;dot&#x22;, text:&#x22;ready&#x22;})
              break;
            case &#x22;unauthorized&#x22;:
              this.status({fill:&#x22;red&#x22;, shape:&#x22;dot&#x22;, text:&#x22;unauthorized&#x22;})
              break;
            case &#x22;error&#x22;:
              this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:error || &#x22;error&#x22;}) //TODO: should we store the last error?
              break;
            case &#x22;closed&#x22;:
              this.status({fill: &#x22;gray&#x22;, shape: &#x22;dot&#x22;, text:&#x22;connection closed&#x22;})
              break;
            // case &#x22;undefined&#x22;:
            // case &#x22;null&#x22;:
            //   break;  //Config node not yet setup
            default:
              this.error(&#x22;Bad lastEvent Data from Config Node - &#x22; + this.config.fbConnection.lastEvent)
          }

        }.bind(this)

        //this.config.fbConnection EventEmitter Handlers
        this.fbInitializing = function(){  //This isn&#x27;t being called because its emitted too early...
          // this.log(&#x22;initializing&#x22;)
          this.setStatus();
        }.bind(this)

        this.fbConnected = function(){
          // this.log(&#x22;connected&#x22;)
          this.setStatus();
        }.bind(this)

        this.fbDisconnected = function(){
          // this.log(&#x22;disconnected&#x22;)
          this.setStatus();
        }.bind(this)

        this.fbAuthorized = function(authData){
          // this.log(&#x22;authorized&#x22;)
          this.setStatus();
        }.bind(this)

        this.fbUnauthorized = function(){
          // this.log(&#x22;unauthorized&#x22;)
          this.setStatus();
        }.bind(this)

        this.fbError = function(error){
          // this.log(&#x22;error - &#x22; + error)
          this.setStatus(error);
          this.error(error, {})
        }.bind(this)

        this.fbClosed = function(){
          // this.log(&#x22;closed&#x22;)
          this.setStatus();
        }.bind(this)


        //Register Handlers
        this.config.fbConnection.on(&#x22;initializing&#x22;, this.fbInitializing)
        this.config.fbConnection.on(&#x22;connected&#x22;, this.fbConnected)
        this.config.fbConnection.on(&#x22;disconnected&#x22;, this.fbDisconnected)
        this.config.fbConnection.on(&#x22;authorized&#x22;, this.fbAuthorized)
        this.config.fbConnection.on(&#x22;unauthorized&#x22;, this.fbUnauthorized)
        this.config.fbConnection.on(&#x22;error&#x22;, this.fbError)
        this.config.fbConnection.on(&#x22;closed&#x22;, this.fbClosed)

        // this.log(&#x22;setting initial state to [fb&#x22; + this.config.fbConnection.lastEvent.capitalize()+ &#x22;](&#x22;+this.config.fbConnection
.lastEventData+&#x22;)&#x22; )

        //set initial state (depending on the deployment strategy, for newly deployed nodes, some of the events may not be refired
...)
        this[&#x22;fb&#x22; + this.config.fbConnection.lastEvent.capitalize()](this.config.fbConnection.lastEventData)  // ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red-contrib-firebase.firebase_on" id="apidoc.module.node-red-contrib-firebase.firebase_on">module node-red-contrib-firebase.firebase_on</a></h1>


    <h2>
        <a href="#apidoc.element.node-red-contrib-firebase.firebase_on.firebase_on" id="apidoc.element.node-red-contrib-firebase.firebase_on.firebase_on">
        function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_on
        <span class="apidocSignatureSpan">(RED)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">firebase_on = function (RED) {
    &#x27;use strict&#x27;;

    var getPushIdTimestamp = (function getPushIdTimestamp() {
      var PUSH_CHARS = &#x27;-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz&#x27;;

      return function getTimestampFromId(id) {
        try {
          var time = 0;
          var data = id.substr(0, 8);

          for (var i = 0; i &#x3c; 8; i++) {
            time = time * 64 + PUSH_CHARS.indexOf(data[i]);
          }

          return time;
        } catch(ex){}
      }
    })();

    function FirebaseOn(n) {
        RED.nodes.createNode(this,n);

        this.config = RED.nodes.getNode(n.firebaseconfig);
        this.childpath = n.childpath;
        this.atStart = n.atStart;
        this.eventType = n.eventType;
		    this.queries = n.queries

        this.ready = false;
        this.ignoreFirst = this.atStart;
        this.authorized = false;
        this.msg = null;

        // Check credentials
        if (!this.config) {
            this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:&#x22;invalid credentials&#x22;})
            this.error(&#x27;You need to setup Firebase credentials!&#x27;);
            return
        }

        this.validEventTypes = {
          &#x22;value&#x22;: true,
          &#x22;child_added&#x22;: true,
          &#x22;child_changed&#x22;: true,
          &#x22;chiled_removed&#x22;: true,
          &#x22;child_moved&#x22;: true,
          &#x22;shallow_query&#x22;: true
        }

        this.onFBValue = function(snapshot, prevChildName) {
            //console.log(&#x22;In onFBValue + &#x22; + JSON.stringify(snapshot.val()))

            if(this.ignoreFirst == false){
              this.ignoreFirst = true
              return;
            }

            this.status({fill:&#x22;blue&#x22;,shape:&#x22;dot&#x22;,text:&#x22;received data&#x22;});

            // if(!snapshot.exists()){
            //   //The code below will simply send a payload of nul if there is no data
            // }

            var msg = {};
            msg.href = snapshot.ref().toString();
            msg.key = snapshot.key();
            msg.payload = snapshot.val();
            if(snapshot.getPriority())
              msg.priority = snapshot.getPriority();
            if(prevChildName)
              msg.previousChildName = prevChildName;
            if(this.eventType.search(&#x22;child&#x22;) != -1 &#x26;&#x26; getPushIdTimestamp(msg.key))  //We probably have a pushID that we can decode
              msg.pushIDTimestamp = getPushIdTimestamp(msg.key)


            this.send(msg);
            setTimeout(this.setStatus, 500)  //Reset back to the Firebase status after 0.5 seconds
        }.bind(this);

        this.onFBError = function(error){
          this.error(error, {})
          this.status({fill:&#x22;red&#x22;,shape:&#x22;ring&#x22;,text:error.code || &#x22;error&#x22;});
          setTimeout(this.setStatus, 5000)  //Reset back to the Firebase status after 5 seconds
        }.bind(this);

        this.registerListeners = function(msg){
          //this.log(&#x22;Registering Listener for &#x22; + this.config.firebaseurl + (this.childpath || &#x22;&#x22;))

          if(this.ready == true)
            return  //Listeners are already created

          this.ready = true;
          this.ignoreFirst = this.atStart;  //Reset if we are re-registering listeners

          //Create the firebase reference to the path
          var ref
          if(this.childpath){
            ref = this.config.fbConnection.fbRef.child(this.childpath  == &#x22;msg.childpath&#x22; ? this.msg.childpath : this.childpath)  //
Decide if we are using our input msg object or the string we were configured with
          } else {
            ref = this.config.fbConnection.fbRef
          }

          //apply the queries
          for (var i=0; i&#x3c;this.queries.length; i+=1) {
              var query = this.queries[i];
              var val

              switch(query.name){
                case &#x22;orderByKey&#x22;:
                case &#x22;orderByValue&#x22;:
                case &#x22;orderByPriority&#x22;:
                  ref = ref[query.name]()  //No args //TODO: BUG: Update HTML to hide box for these 3...
                  break;

                case &#x22;orderByChild&#x22;:
                case &#x22;startAt&#x22;:
                case &#x22;endAt&#x22;:
                case &#x22;equalTo&#x22;: ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red-contrib-firebase.firebase_once" id="apidoc.module.node-red-contrib-firebase.firebase_once">module node-red-contrib-firebase.firebase_once</a></h1>


    <h2>
        <a href="#apidoc.element.node-red-contrib-firebase.firebase_once.firebase_once" id="apidoc.element.node-red-contrib-firebase.firebase_once.firebase_once">
        function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_once
        <span class="apidocSignatureSpan">(RED)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">firebase_once = function (RED) {
    &#x27;use strict&#x27;;
    var https = require(&#x22;follow-redirects&#x22;).https;
    var urllib = require(&#x22;url&#x22;);

    var getPushIdTimestamp = (function getPushIdTimestamp() {
      var PUSH_CHARS = &#x27;-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz&#x27;;

      return function getTimestampFromId(id) {
        try {
          var time = 0;
          var data = id.substr(0, 8);

          for (var i = 0; i &#x3c; 8; i++) {
            time = time * 64 + PUSH_CHARS.indexOf(data[i]);
          }

          return time;
        } catch(ex){}
      }
    })();

    function FirebaseOnce(n) {
        RED.nodes.createNode(this,n);

        this.config = RED.nodes.getNode(n.firebaseconfig);
        this.childpath = n.childpath;
        this.eventType = n.eventType;
        this.queries = n.queries;
        this.repeatifnull = n.repeatifnull;

        this.activeRequests = [];
        this.ready = false;

        // Check credentials
        if (!this.config) {
            this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:&#x22;invalid credentials&#x22;})
            this.error(&#x27;You need to setup Firebase credentials!&#x27;);
            return
        }

        // for (var i=0; i&#x3c;this.queries.length; i+=1) {
        //     var query = this.queries[i];
        //     if (!isNaN(Number(query.value))) {
        //       query.value = Number(query.value);
        //       query.value2 = Number(query.value2);
        //     }
        // }

        this.validEventTypes = {
          &#x22;value&#x22;: true,
          &#x22;child_added&#x22;: true,
          &#x22;child_changed&#x22;: true,
          &#x22;chiled_removed&#x22;: true,
          &#x22;child_moved&#x22;: true,
          &#x22;shallow_query&#x22;: true
        }

        this.onFBData = function(snapshot, prevChildName) {
            //console.log(&#x22;In onFBData + &#x22; + JSON.stringify(snapshot.val()))
            //TODO: Once Node-Red supports it, we should flash the Node when we receive this data.

            // if(!snapshot.exists()){
            //   //The code below will simply send a payload of nul if there is no data
            // }

            //Tstart with original message object so we retain all of those properties...
            var msg = this.activeRequests.shift();

            msg.href = snapshot.ref().toString();
            msg.key = snapshot.key();
            msg.payload = snapshot.val();
            if(snapshot.getPriority())
              msg.priority = snapshot.getPriority();
            if(prevChildName)
              msg.previousChildName = prevChildName;
            if(this.eventType.search(&#x22;child&#x22;) != -1 || msg.key.length == 20 &#x26;&#x26; getPushIdTimestamp(msg.key))  //We probably have
a pushID that we can decode
              msg.pushIDTimestamp = getPushIdTimestamp(msg.key)

            if(this.repeatifnull &#x26;&#x26; msg.payload == null &#x26;&#x26; msg.attemptNumber++ &#x3c; 100 ){ // Repeat sending the request.  //TODO:
we could use a configurable timer in seconds or a configurable number of attempts
              this.registerListeners(msg)
            } else {
              this.send(msg);
            }

            this.setStatus();
        }.bind(this);

        this.onFBError = function(error){
          this.error(error, {})
          this.status({fill:&#x22;red&#x22;,shape:&#x22;ring&#x22;,text:error.code || &#x22;error&#x22;});
          setTimeout(this.setStatus, 5000)  //Reset back to the Firebase status after 5 seconds
        }.bind(this);

        this.registerListeners = function(msg){

          var eventType = this.eventType
          if(eventType == &#x22;msg.eventType&#x22;){
            if(&#x22;eventType&#x22; in msg){
              eventType = msg.eventType
            } else {
              this.error(&#x22;Expected \&#x22;eventType\&#x22; property in msg object&#x22;, msg)
              return;
            }
          }

          if(!(eventType in this.validEventTypes)){
            this.error(&#x22;Invalid msg.eventType property \&#x22;&#x22; + eventType + &#x22;\&#x22;.  Expected one of the following: [\&#x22;&#x22; + Object.keys
(this.validEventTypes).join(&#x22;\&#x22;, \&#x22;&#x22;) + &#x22;\&#x22;].&#x22;, msg)
            return;
          }

          //Parse out msg.childpath
          var childpath = this.childpath
          if(childpath == &#x22; ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.node-red-contrib-firebase.firebase_ondisconnect" id="apidoc.module.node-red-contrib-firebase.firebase_ondisconnect">module node-red-contrib-firebase.firebase_ondisconnect</a></h1>


    <h2>
        <a href="#apidoc.element.node-red-contrib-firebase.firebase_ondisconnect.firebase_ondisconnect" id="apidoc.element.node-red-contrib-firebase.firebase_ondisconnect.firebase_ondisconnect">
        function <span class="apidocSignatureSpan">node-red-contrib-firebase.</span>firebase_ondisconnect
        <span class="apidocSignatureSpan">(RED)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">firebase_ondisconnect = function (RED) {
    &#x27;use strict&#x27;;
    var path= require(&#x27;path&#x27;);

    String.prototype.capitalize = function() {
        return this.charAt(0).toUpperCase() + this.slice(1);
    }

    function FirebaseOnDisconnect(n) {
        RED.nodes.createNode(this,n);

        this.config = RED.nodes.getNode(n.firebaseconfig);
        this.name = n.name;
        this.childpath = n.childpath;
        this.method = n.method;
        this.value = n.value;
        this.priority = n.priority;
        this.fbRequests = [];

        this.ready = false;

        this.validMethods = {
          &#x22;set&#x22;: true,
          &#x22;update&#x22;: true,
          &#x22;remove&#x22;: true,
          &#x22;setWithPriority&#x22;: true,
          &#x22;cancel&#x22;: true
        }

        // Check credentials
        if (!this.config) {
            this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:&#x22;invalid credentials&#x22;})
            this.error(&#x27;You need to setup Firebase credentials!&#x27;);
            return
        }

        this.fbOnComplete = function(error) {
            //this.log(&#x22;fb oncomplete.  error = &#x22; + error)
            var msg = this.fbRequests.shift() //Firebase will call these in order for us
            //TODO: Once Node-Red supports it, we should flash the Node when we receive this data.
            if(error){
              //this.log(&#x22;firebase synchronization failed&#x22;)
              this.error(&#x22;firebase synchronization failed - &#x22; + error, msg)
            }
        }.bind(this);


        //this.config.fbConnection EventEmitter Handlers
        this.fbInitializing = function(){  //This isn&#x27;t being called because its emitted too early...
          // this.log(&#x22;initializing&#x22;)
          this.status({fill:&#x22;grey&#x22;, shape:&#x22;ring&#x22;, text:&#x22;initializing...&#x22;})
          this.ready = false;
        }.bind(this)

        this.fbConnected = function(){
          // this.log(&#x22;connected&#x22;)
          this.status({fill:&#x22;green&#x22;, shape:&#x22;ring&#x22;, text:&#x22;connected&#x22;})
          // this.ready = false;
        }.bind(this)

        this.fbDisconnected = function(){
          // this.log(&#x22;disconnected&#x22;)
          this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:&#x22;disconnected&#x22;})
          this.ready = false;
        }.bind(this)

        this.fbAuthorized = function(authData){
          // this.log(&#x22;authorized&#x22;)
          this.status({fill:&#x22;green&#x22;, shape:&#x22;dot&#x22;, text:&#x22;ready&#x22;})
          this.ready = true;
          if (this.value != &#x22;msg.payload&#x22; &#x26;&#x26; this.method != &#x22;msg.method&#x22; &#x26;&#x26; this.childpath != &#x22;msg.childpath&#x22;){
            //this.warn(&#x22;FB Authorized -- explicitly emitting event INPUT&#x22;);
            this.emit(&#x27;input&#x27;, {});
          }
        }.bind(this)

        this.fbUnauthorized = function(){
          // this.log(&#x22;unauthorized&#x22;)
          this.status({fill:&#x22;red&#x22;, shape:&#x22;dot&#x22;, text:&#x22;unauthorized&#x22;})
          this.ready = false;
        }.bind(this)

        this.fbError = function(error){
          // this.log(&#x22;error&#x22;)
          this.status({fill:&#x22;red&#x22;, shape:&#x22;ring&#x22;, text:error})
          this.error(error, {})
        }.bind(this)

        this.fbClosed = function(error){
          // this.log(&#x22;closed&#x22;)
          this.status({fill: &#x22;gray&#x22;, shape: &#x22;dot&#x22;, text:&#x22;connection closed&#x22;})
          this.ready = false;
        }.bind(this)

        //Register Handlers
        this.config.fbConnection.on(&#x22;initializing&#x22;, this.fbInitializing)
        this.config.fbConnection.on(&#x22;connected&#x22;, this.fbConnected)
        this.config.fbConnection.on(&#x22;disconnected&#x22;, this.fbDisconnected)
        this.config.fbConnection.on(&#x22;authorized&#x22;, this.fbAuthorized)
        this.config.fbConnection.on(&#x22;unauthorized&#x22;, this.fbUnauthorized)
        this.config.fbConnection.on(&#x22;error&#x22;, this.fbError)
        this.config.fbConnection.on(&#x22;closed&#x22;, this.fbClosed)

        //set initial state (depending on the deployment strategy, for newly deployed nodes, some of the events may not be refired
...)
        switch(this.config.fbConnection.lastEvent) {
          case &#x22;initializing&#x22;:
          case &#x22;connected&#x22;:
          case &#x22;disconnected&#x22;:
          case &#x22;authorized&#x22;:
          case &#x22;unauthorized&#x22;:
          case &#x22;error&#x22;:
          case &#x22;closed&#x22;: ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
